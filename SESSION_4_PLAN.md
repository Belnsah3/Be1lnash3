# üîß –°–µ—Å—Å–∏—è 4: Function Calling –¥–ª—è API

## üéØ –¶–µ–ª—å
–î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—É—é –ø–æ–¥–¥–µ—Ä–∂–∫—É Function Calling –≤ API –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ñ–∞–π–ª–∞–º–∏ –∏ –ø–ª–∞–≥–∏–Ω–∞–º–∏.

---

## üìù –ß—Ç–æ –Ω—É–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å:

### 1. **–°–∏—Å—Ç–µ–º–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —Ñ—É–Ω–∫—Ü–∏–π** üõ†Ô∏è
- Registry –¥–ª—è –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π
- –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—ã–∑–æ–≤–æ–≤

### 2. **API –æ–±—Ä–∞–±–æ—Ç–∫–∞ tools** üîå
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ `tools` –≤ –∑–∞–ø—Ä–æ—Å–µ
- –û–±—Ä–∞–±–æ—Ç–∫–∞ `tool_calls` –æ—Ç AI
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–π
- –í–æ–∑–≤—Ä–∞—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

### 3. **–§–∞–π–ª–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏** üìÅ
- `read_file` - –ß—Ç–µ–Ω–∏–µ —Ñ–∞–π–ª–∞
- `list_directory` - –°–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤
- `search_in_files` - –ü–æ–∏—Å–∫ –ø–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–º—É
- `get_file_info` - –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ñ–∞–π–ª–µ

### 4. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è –±–æ–ª—å—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö** ‚ö°
- Chunking (—á—Ç–µ–Ω–∏–µ –ø–æ —á–∞—Å—Ç—è–º)
- –õ–∏–º–∏—Ç—ã –Ω–∞ —Ä–∞–∑–º–µ—Ä
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤

---

## üîÑ –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:

```
1. –ö–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å —Å tools:
   POST /api/v1/ai/chat/completions
   {
     "model": "gpt-4",
     "messages": [...],
     "tools": [...]
   }

2. –°–µ—Ä–≤–µ—Ä –ø—Ä–æ–∫—Å–∏—Ä—É–µ—Ç –∫ GPT4Free —Å tools

3. AI —Ä–µ—à–∞–µ—Ç –≤—ã–∑–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é:
   Response: {
     "tool_calls": [
       {
         "function": "read_file",
         "arguments": {"path": "plugins/MyPlugin.java"}
       }
     ]
   }

4. –°–µ—Ä–≤–µ—Ä –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é:
   - –ß–∏—Ç–∞–µ—Ç —Ñ–∞–π–ª
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ

5. –ö–ª–∏–µ–Ω—Ç –ø–æ–ª—É—á–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏ –º–æ–∂–µ—Ç –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å –¥–∏–∞–ª–æ–≥
```

---

## üìã –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:

### **–ó–∞–ø—Ä–æ—Å –æ—Ç –∫–ª–∏–µ–Ω—Ç–∞:**
```json
POST /api/v1/ai/chat/completions
Headers:
  Authorization: Bearer YOUR_API_KEY
Body:
{
  "model": "gpt-4",
  "messages": [
    {
      "role": "user",
      "content": "–ü—Ä–æ—á–∏—Ç–∞–π —Ñ–∞–π–ª plugins/MyPlugin/src/Main.java"
    }
  ],
  "tools": [
    {
      "type": "function",
      "function": {
        "name": "read_file",
        "description": "–ß–∏—Ç–∞–µ—Ç —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞",
        "parameters": {
          "type": "object",
          "properties": {
            "path": {
              "type": "string",
              "description": "–ü—É—Ç—å –∫ —Ñ–∞–π–ª—É"
            }
          },
          "required": ["path"]
        }
      }
    }
  ]
}
```

### **–û—Ç–≤–µ—Ç –æ—Ç AI —Å tool_call:**
```json
{
  "choices": [
    {
      "message": {
        "role": "assistant",
        "content": null,
        "tool_calls": [
          {
            "id": "call_abc123",
            "type": "function",
            "function": {
              "name": "read_file",
              "arguments": "{\"path\":\"plugins/MyPlugin/src/Main.java\"}"
            }
          }
        ]
      }
    }
  ]
}
```

### **–ö–ª–∏–µ–Ω—Ç –≤—ã–∑—ã–≤–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```json
{
  "model": "gpt-4",
  "messages": [
    {...previous messages...},
    {
      "role": "tool",
      "tool_call_id": "call_abc123",
      "content": "public class Main { ... }"
    }
  ]
}
```

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:

### **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:**
- ‚úÖ –¢–æ–ª—å–∫–æ —á—Ç–µ–Ω–∏–µ (–Ω–µ –∑–∞–ø–∏—Å—å/—É–¥–∞–ª–µ–Ω–∏–µ)
- ‚úÖ –ë–µ–ª—ã–π —Å–ø–∏—Å–æ–∫ –ø–∞–ø–æ–∫ (—Ç–æ–ª—å–∫–æ plugins/)
- ‚úÖ –õ–∏–º–∏—Ç —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞ (–º–∞–∫—Å. 1MB)
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—É—Ç–∏ (no path traversal)
- ‚úÖ Rate limiting

### **–í–∞–ª–∏–¥–∞—Ü–∏—è:**
- –ü—Ä–æ–≤–µ—Ä–∫–∞ API –∫–ª—é—á–∞
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
- –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –≤—ã–∑–æ–≤–æ–≤

---

## üìÅ –§–∞–π–ª—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è/–∏–∑–º–µ–Ω–µ–Ω–∏—è:

### **–ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã:**
- `src/functions/registry.js` - –°–∏—Å—Ç–µ–º–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —Ñ—É–Ω–∫—Ü–∏–π
- `src/functions/file-tools.js` - –§–∞–π–ª–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
- `src/functions/validators.js` - –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- `src/middleware/function-calling.js` - Middleware –¥–ª—è tools

### **–ò–∑–º–µ–Ω—è–µ–º—ã–µ —Ñ–∞–π–ª—ã:**
- `src/routes/ai.js` - –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É tools
- `src/config/functions.js` - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Ñ—É–Ω–∫—Ü–∏–π

---

## üé® –î–æ—Å—Ç—É–ø–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:

### **1. read_file**
–ß–∏—Ç–∞–µ—Ç —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `path` (string) - –ü—É—Ç—å –∫ —Ñ–∞–π–ª—É

**–ü—Ä–∏–º–µ—Ä:**
```json
{
  "name": "read_file",
  "arguments": {
    "path": "plugins/MyPlugin/src/Main.java"
  }
}
```

**–í–æ–∑–≤—Ä–∞—Ç:**
```json
{
  "success": true,
  "content": "public class Main {...}",
  "size": 1234,
  "encoding": "utf-8"
}
```

---

### **2. list_directory**
–°–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤ –≤ –ø–∞–ø–∫–µ.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `path` (string) - –ü—É—Ç—å –∫ –ø–∞–ø–∫–µ
- `recursive` (boolean) - –†–µ–∫—É—Ä—Å–∏–≤–Ω–æ (default: false)
- `filter` (string) - –§–∏–ª—å—Ç—Ä –ø–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—é (*.java)

**–ü—Ä–∏–º–µ—Ä:**
```json
{
  "name": "list_directory",
  "arguments": {
    "path": "plugins/MyPlugin/src",
    "recursive": true,
    "filter": "*.java"
  }
}
```

**–í–æ–∑–≤—Ä–∞—Ç:**
```json
{
  "success": true,
  "files": [
    {
      "name": "Main.java",
      "path": "plugins/MyPlugin/src/Main.java",
      "size": 1234,
      "modified": "2025-11-05T12:00:00Z"
    }
  ],
  "total": 1
}
```

---

### **3. search_in_files**
–ü–æ–∏—Å–∫ —Ç–µ–∫—Å—Ç–∞ –≤ —Ñ–∞–π–ª–∞—Ö.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `path` (string) - –ü—É—Ç—å –∫ –ø–∞–ø–∫–µ
- `query` (string) - –ü–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å
- `case_sensitive` (boolean) - –£—á–∏—Ç—ã–≤–∞—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä (default: false)
- `file_pattern` (string) - –ü–∞—Ç—Ç–µ—Ä–Ω —Ñ–∞–π–ª–æ–≤ (*.java)

**–ü—Ä–∏–º–µ—Ä:**
```json
{
  "name": "search_in_files",
  "arguments": {
    "path": "plugins",
    "query": "onPlayerJoin",
    "file_pattern": "*.java"
  }
}
```

**–í–æ–∑–≤—Ä–∞—Ç:**
```json
{
  "success": true,
  "results": [
    {
      "file": "plugins/MyPlugin/src/Main.java",
      "line": 42,
      "content": "public void onPlayerJoin(PlayerJoinEvent e) {",
      "matches": 1
    }
  ],
  "total_matches": 1
}
```

---

### **4. get_file_info**
–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ñ–∞–π–ª–µ.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `path` (string) - –ü—É—Ç—å –∫ —Ñ–∞–π–ª—É

**–ü—Ä–∏–º–µ—Ä:**
```json
{
  "name": "get_file_info",
  "arguments": {
    "path": "plugins/MyPlugin.jar"
  }
}
```

**–í–æ–∑–≤—Ä–∞—Ç:**
```json
{
  "success": true,
  "name": "MyPlugin.jar",
  "size": 102400,
  "extension": ".jar",
  "created": "2025-11-01T10:00:00Z",
  "modified": "2025-11-05T12:00:00Z",
  "is_directory": false
}
```

---

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:

### **config/functions.js:**
```javascript
module.exports = {
  // –†–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ –ø–∞–ø–∫–∏
  allowedPaths: [
    '/path/to/plugins',
    '/path/to/docs'
  ],
  
  // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ (1MB)
  maxFileSize: 1024 * 1024,
  
  // –ú–∞–∫—Å–∏–º—É–º —Ñ–∞–π–ª–æ–≤ –≤ –ª–∏—Å—Ç–∏–Ω–≥–µ
  maxFilesInList: 100,
  
  // –¢–∞–π–º–∞—É—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–∏ (5 —Å–µ–∫)
  executionTimeout: 5000,
  
  // –†–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –¥–ª—è —á—Ç–µ–Ω–∏—è
  allowedExtensions: [
    '.java', '.js', '.json', '.yml', '.yaml',
    '.txt', '.md', '.properties', '.xml'
  ]
};
```

---

## üìä –ü—Ä–æ–≥—Ä–µ—Å—Å –°–µ—Å—Å–∏–∏ 4:

- ‚è≥ –°–∏—Å—Ç–µ–º–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —Ñ—É–Ω–∫—Ü–∏–π (0%)
- ‚è≥ API –æ–±—Ä–∞–±–æ—Ç–∫–∞ tools (0%)
- ‚è≥ –§–∞–π–ª–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ (0%)
- ‚è≥ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (0%)

**–û–±—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å –°–µ—Å—Å–∏–∏ 4:** 0%

---

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç:

### **Backend:**
- [ ] –°–æ–∑–¥–∞—Ç—å registry –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–π
- [ ] –î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å read_file
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å list_directory
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å search_in_files
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å get_file_info
- [ ] –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É tools –≤ ai.js
- [ ] –î–æ–±–∞–≤–∏—Ç—å middleware –¥–ª—è function calling
- [ ] –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- [ ] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—ã–∑–æ–≤–æ–≤

### **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:**
- [ ] –í–∞–ª–∏–¥–∞—Ü–∏—è –ø—É—Ç–µ–π (no path traversal)
- [ ] –ë–µ–ª—ã–π —Å–ø–∏—Å–æ–∫ –ø–∞–ø–æ–∫
- [ ] –õ–∏–º–∏—Ç —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–æ–≤
- [ ] Rate limiting
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ API –∫–ª—é—á–∞

### **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- [ ] –¢–µ—Å—Ç—ã –¥–ª—è –∫–∞–∂–¥–æ–π —Ñ—É–Ω–∫—Ü–∏–∏
- [ ] –¢–µ—Å—Ç—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API

---

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç:

–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –°–µ—Å—Å–∏–∏ 4:
- ‚úÖ –ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π Function Calling
- ‚úÖ –†–∞–±–æ—Ç–∞ —Å —Ñ–∞–π–ª–∞–º–∏ —á–µ—Ä–µ–∑ API
- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —á—Ç–µ–Ω–∏–µ –ø–ª–∞–≥–∏–Ω–æ–≤
- ‚úÖ –ü–æ–∏—Å–∫ –ø–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–º—É

**–û–±—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å –ø—Ä–æ–µ–∫—Ç–∞:** 90% ‚Üí 100%! üéâ

---

–ù–∞—á–∏–Ω–∞–µ–º! üöÄ
